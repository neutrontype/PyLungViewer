#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
Модуль с предустановками окон для различных типов тканей в КТ-снимках.
"""

class WindowPresets:
    """Класс с предустановками окон отображения для КТ снимков."""
    
    # Стандартные предустановки окон КТ (значения в единицах Хаунсфилда)
    PRESETS = {
        # Название: (центр, ширина)
        "Легочное": (-600, 1500),
        "Медиастинальное": (40, 400),
        "Костное": (400, 1800),
        "Мягкие ткани": (50, 350),
        "Мозг": (40, 80),
        "Пользовательское": (0, 0)  # Будет заполнено из настроек пользователя
    }
    
    @staticmethod
    def get_preset(name):
        """
        Получение параметров окна по названию предустановки.
        
        Args:
            name: Название предустановки.
            
        Returns:
            tuple: Параметры окна (центр, ширина) или None, если предустановка не найдена.
        """
        return WindowPresets.PRESETS.get(name, (0, 0))
    
    @staticmethod
    def apply_window(pixel_data, center, width):
        """
        Применение параметров окна к пиксельным данным.
        
        Args:
            pixel_data: Массив пиксельных данных.
            center: Центр окна.
            width: Ширина окна.
            
        Returns:
            array: Преобразованные пиксельные данные.
        """
        import numpy as np
        
        # Копируем данные, чтобы не изменять оригинал
        result = pixel_data.copy()
        
        # Вычисляем границы окна
        min_val = center - width/2
        max_val = center + width/2
        
        # Ограничиваем значения диапазоном окна
        result = np.clip(result, min_val, max_val)
        
        # Нормализуем значения для отображения (0-255)
        if min_val != max_val:  # Избегаем деления на ноль
            result = 255 * (result - min_val) / (max_val - min_val)
        
        return result.astype(np.uint8)